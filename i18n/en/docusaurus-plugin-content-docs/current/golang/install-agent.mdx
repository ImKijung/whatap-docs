---
id: install-agent
title: Agent Installation
description: The following explains how to install an agent on the application server in the Golang environment.
tags:
  - Golang
  - Agent Installation
---

import TR from '@site/src/components/TR';

An agent must be installed on the same server to forward data from the monitored application server through UDP communication and to transfer the data to the WhaTap collection server. The agent can be installed using the package.

1.  Install the WhaTap repository.

2.  Install the whatap-agent Linux package (yum, apt-get).

3.  Run the whatap-agent service.

![Golang Monitoring](https://img.whatap.io/media/images/golang_system.png)

To use the WhaTap monitoring service, after [Sign up](https://www.whatap.io/ko/signup/), create a project and then install the agent to the target server.

{@include: ../getting-started/_create-project-v2.mdx}   

{@include: ../getting-started/_accesskey-v2.mdx} 

## Downloading the agent

Once you have received the **access key**, download the agent with the following command.

<Tabs groupId="golang">
<TabItem value="redhat-centos" label="Red Hat/CentOS">

```bash title='SH'
## Register the package repository
$ sudo rpm -Uvh https://repo.whatap.io/centos/5/noarch/whatap-repo-1.0-1.noarch.rpm

## Install the package
$ sudo yum install whatap-agent
```

</TabItem>
<TabItem value="debian-ubuntu" label="Debian/Ubuntu">

```bash title='SH'
## Register the package repository
$ wget https://repo.whatap.io/debian/release.gpg -O -|sudo apt-key add -
$ wget https://repo.whatap.io/debian/whatap-repo_1.0_all.deb
$ sudo dpkg -i whatap-repo_1.0_all.deb
$ sudo apt-get update

## Install the package
$ sudo apt-get install whatap-agent
```

</TabItem>
<TabItem value="amazonlinux" label="Amazon Linux">

```bash title='SH'
## Register the package repository
$ sudo rpm --import https://repo.whatap.io/centos/release.gpg
$ echo "[whatap]" | sudo tee /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "name=whatap packages for enterprise linux" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "baseurl=https://repo.whatap.io/centos/latest/\$basearch" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "enabled=1" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null
$ echo "gpgcheck=0" | sudo tee -a /etc/yum.repos.d/whatap.repo > /dev/null

## Install the package
$ sudo yum install whatap-agent
```

</TabItem>
<TabItem value="alpinelinux" label="Alpine Linux">

[whatap-agent.tar.gz]After downloading the file (https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz), unzip the file based on the "/" directory. Create the monitoring file in the _/usr/whatap/agent_ path.

```bash title='SH'
$ wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz
$ tar -xvzf whatap-agent.tar.gz -C /
```

</TabItem>
<TabItem value="al-docker" label="Alpine Linux Docker">

[whatap-agent.tar.gz]After downloading the file (https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz), unzip the file in the _/usr/whatap/agent_ path.

```bash title='SH'
FROM alpine

RUN apk update && apk upgrade

# Install WhaTap Golang monitoring agent
RUN wget https://s3.ap-northeast-2.amazonaws.com/repo.whatap.io/alpine/x86_64/whatap-agent.tar.gz
RUN tar -xvzf whatap-agent.tar.gz -C /
```

</TabItem>
</Tabs>

<details>
<summary>Agent configuration file</summary>

It consists of a tracer to collect the monitoring data, an agent to transmit the collected data to the server, and an installation script file to dynamically apply the tracer and agent to the server.

-   _whatap-agent_: This program transmits the data passed from the agent and tracer to UDP, to the collection server.

-   _/etc/init.d/whatap-agent_: Service script file.

-   _whatap_agent_: Service execution file.

-   _whatap.conf_: Enter the configuration data, collection server IP, and access key in this file.

-   _whatap-boot-`yyyymmdd`.log_: Agent log file. (path: _/usr/whata/agent/log_)

</details>

## 에이전트 설정{#set-agent}

### 기본 설정하기

다음 명령어를 차례로 실행해 _whatap.conf_ 파일에 **액세스 키**와 **수집 서버 IP 주소** 등을 설정하세요.

-   Create the _whatap.conf_ file in the path of the application startup script. 

-   If the `WHATAP_HOME` environment variable has not been set, the path of the application startup script is recognized as the one of the _whatap.conf_ file.

```bash title='SH'
# 스크립트 실행 경로에 whatap.conf 파일 생성
$ echo "license={액세스 키}" >> ./whatap.conf
$ echo "whatap.server.host={수집 서버 IP 주소}" >> ./whatap.conf
$ echo "app_name={애플리케이션 이름}" >> ./whatap.conf

# 애플리케이션 실행
./app
```

-   `license`: Enter the **access key**.

-   `whatap.server.host`: Enter the **collection server IP address**.

-   `app_name`: 애플리케이션 이름을 입력하세요. 문자열을 이용해 사용자 설정할 수 있습니다.

### `WHATAP_HOME` 환경 변수 설정하기

_whatap.conf_ 파일 경로를 `WHATAP_HOME` 환경 변수로 설정할 수 있습니다. `WHATAP_HOME` 경로를 우선 생성하세요.

```bash
# WHATAP_HOME 경로 우선 생성 후 whatap.conf 파일 경로 설정
mkdir ./whatap_home
echo "license={액세스 키}" >> ./whatap_home/whatap.conf
echo "whatap.server.host={수집 서버 IP 주소}" >> ./whatap_home/whatap.conf
echo "app_name={애플리케이션 이름}" >> ./whatap_home/whatap.conf

# 애플리케이션 실행
WHATAP_HOME=./whatap_home ./app
```

### 프로세스 별 에이전트 이름 설정{#duplicate_appname}

2개 이상의 프로세스로 실행되는 애플리케이션에서 1개의 _whatap.conf_ 파일을 공유하면 사용자가 설정한 변경 사항이 정상 반영되지 않을 수 있습니다. 프로세스 별로 각각의 _whatap.conf_ 파일을 설정할 것을 권장합니다.

에이전트 이름이 중복되지 않도록 사용자는 문자열을 에이전트 이름에 추가해 구분할 수 있습니다. `app_name` 옵션으로 설정한 값이 에이전트 이름의 가장 앞 부분에 추가됩니다.

You can avoid duplicate names of agents run with the same command and the same instance. 

```bash
# WHATAP_HOME 경로 우선 생성 후 whatap.conf 파일 경로 설정
mkdir ./whatap_home
echo "license={액세스 키}" >> ./whatap_home/whatap.conf
echo "whatap.server.host={수집 서버 IP 주소}" >> ./whatap_home/whatap.conf
echo "app_name={애플리케이션 이름-1}" >> ./whatap_home/whatap.conf

# 애플리케이션 실행
WHATAP_HOME=./whatap_home ./app 

# WHATAP_HOME 경로 우선 생성 후 whatap.conf 파일 경로 설정
mkdir ./whatap_home1
echo "license={액세스 키}" >> ./whatap_home1/whatap.conf
echo "whatap.server.host={수집 서버 IP 주소}" >> ./whatap_home1/whatap.conf
echo "app_name={애플리케이션 이름-2}" >> ./whatap_home1/whatap.conf

# 애플리케이션 실행
WHATAP_HOME=./whatap_home1 ./app

```

## Using the Golang library

Add whatap/go-api to the Golang application source code and release it.

<Tabs groupId="golang">
<TabItem value="redhat-centos" label="Red Hat/CentOS">

```bash
$ go get github.com/whatap/go-api
```

</TabItem>
<TabItem value="debian-ubuntu" label="Debian/Ubuntu">

```bash
$ go get github.com/whatap/go-api/trace
$ go get github.com/whatap/go-api/sql
$ go get github.com/whatap/go-api/httpc
$ go get github.com/whatap/go-api/method
```

</TabItem>
<TabItem value="amazonlinux" label="Amazon Linux">

```bash
$ go get github.com/whatap/go-api/trace
$ go get github.com/whatap/go-api/sql
$ go get github.com/whatap/go-api/httpc
$ go get github.com/whatap/go-api/method
```

</TabItem>
</Tabs>

```go title='GO'
import "github.com/whatap/go-api/trace"

func main(){
    trace.Init(nil)
    //It must be executed before closing the app.
    defer trace.Shutdown()
    ...
}
```

## Starting the monitoring

<Tabs groupId="golang">
<TabItem value="redhat-centos" label="Red Hat/CentOS">

Once the application server has been restarted, the agent starts collecting data.

</TabItem>
<TabItem value="debian-ubuntu" label="Debian/Ubuntu">

Once the application server has been restarted, the agent starts collecting data.

</TabItem>
<TabItem value="amazonlinux" label="Amazon Linux">

1.  Execute the following command to install the WhaTap agent daemon.

    ```bash
    /usr/whatap/php/whatap-agent start
    ```

2.  다음 명령어를 실행해 와탭 서비스가 정상 실행됐는지 확인하세요.

    ```bash
    ps -elf | grep whatap_agent_static
    ```

Once the application server has been restarted, the agent starts collecting data.

</TabItem>
</Tabs>
