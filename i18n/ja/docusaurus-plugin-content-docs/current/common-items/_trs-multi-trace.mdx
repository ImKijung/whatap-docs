**マルチトランザクション**は、別のエージェントやプロジェクトに関連付けられたトランザクションを意味します。WhaTapプロジェクトに登録されたアプリケーションサービス間の呼び出しを追跡するのが、**マルチトランザクション追跡**です。 

:::note

**マルチトランザクションの活性化**

マルチトランザクションを追跡するには、活性化オプションを設定する必要があります。 

1.  **_管理_** > **_エージェント設定_**メニューに移動します。 
2.  **_マルチサーバートランザクション_**設定の下にある**_活性化_**オプションの`mtrace_enabled`の値を`true`に設定指定します。

:::

## マルチトランザクショントレース

ホーム画面 > プロジェクト選択 > **_分析_** > **_ヒートマップ_**メニューからチャート領域をドラッグします。ドラッグしたチャート領域のトランザクション情報は、次のように下部の**_TXトレース_**一覧に表示されます。一覧でマルチトランザクションを含むトランザクションは、![アイコン](/img/ic-s-mult-transation.svg)アイコンが表示されます。

![mtrace_M](/img/tx-trace-table.png)

トレースを選択すると、**_統計_**情報ウィンドウが表示されます。マルチトランザクションが追跡されている場合は、上部の概要情報タブの**_マルチトランザクション_**で**_MTID_**値を確認することができます。トランザクションで外部呼び出しを行うと、同じ**_MTID_**が生成されます。サービスごとにプロジェクトが分離されている場合でも、初めて発行された**_MTID_**を使用して、アプリケーション間のすべてのトランザクションを確認できます。**_統計_**ウィンドウを使用したTXトレースの詳細な分析の詳細については、[次の文書](trs-profile#details)を参照してください。

![mtrace_apm](/img/tx-trace-dt-up.png)

**_MTID_**横の![右矢印アイコン](/img/ic-arrow-right.svg)アイコンを選択すると、**_分析_** > **_マルチトランザクション追跡_**メニューに移動します。**_マルチトランザクション追跡_**メニューでシステム内またはシステム間で発生する様々な呼び出し関係をひと目で把握し、どの部分で問題が発生したのかを識別して改善できるようにトランザクションとトレース情報を提供します。 

![マルチトランザクションチャートsc](/img/multi-tx-cht.png)

![number 1](/img/number-01.png)領域は、**_フィルターパネル_**です。検索のための特定キー値(**_MTID_** / **_CUSTID_**)やプロジェクト一覧を編集して情報をフィルタリングすることができます。適用されたフィルターは、右側の![number 2](/img/number-02.png)に表示されるタブ一覧である**_チャートビュー_**、**_テーブルビュー_**、**_ツリービュー_**の各タブに適用されます。

### チャートビュー

**_マルチトランザクション追跡_**メニューの基本画面は、**_チャートビュー_**です。**_チャートビュー_**タブでは、各トランザクションの呼び出し関係を迅速かつ明確にユーザーに提供します。同じ**_MTID_**を持つトランザクションサービスの個々の実行時間を確認することができます。トランザクションノードの背景色として表現される所要時間(**_タイムバー_**)を見ると、トランザクション間の呼び出し関係を確認することができます。 

**_チャートビュー_**![number 3](/img/number-03.png)領域のオプションを使用して、**_タイムバー_**を含む追加情報を確認することができます。**_フォントサイズ_**ボタンを選択すると、チャートに表示されるフォントのサイズを調整できます。**_タイムバー_**、**_アプリケーション名_**、**_プロジェクト_**ボタンを選択すると、ノードで表示される情報を制御することができます。右側にある**_データベース_**、**_外部呼び出し_**、**_内部呼び出し_**ボタンを選択すると、トランザクションで発生した他のデータベースコネクションリクエストやHTTP Callの情報もチャートのノードで確認できます。

トランザクションノードを選択すると、次のように**_統計_**ウィンドウが表示されます。 トランザクショントレースを使用して、トランザクションの詳細を確認できます。 **_統計_** ウィンドウを使用したトランザクショントレースの詳細な分析の詳細については、[次の文書](trs-profile#details)を参照してください。

![マルチトランザクションの詳細を見る](/img/multi-tx-stat.png)

### テーブルビュー

**_テーブルビュー_**タブを選択すると、テーブル形式でマルチトランザクション内に含まれる各トランザクションごとの情報を確認できます。![カラム選択アイコン](/img/ic-column.svg) **_カラム選択_**アイコンを選択してテーブル内のカラムを編集できます。 

![マルチトランザクションテーブルビュー](/img/multi-tx-tb.png)

![詳細アイコン](/img/ic-pageview.svg)**_詳細_**アイコンを選択すると、**_チャートビュー_**ノード選択と同様に**_統計_**ウィンドウが表示されます。 トランザクショントレースを使用して、トランザクションの詳細を確認できます。 **_統計_** ウィンドウを使用したトランザクショントレースの詳細な分析に関する詳細については、[次の文書](trs-profile#details)を参照してください。

### ツリービュー

**_ツリービュー_**タブを選択すると、各トランザクションとそれに属するトレースの詳細が確認できます。トランザクションの所要時間内の各サブトランザクションまたはトレースの開始と所要時間を視覚化し、トランザクションの呼び出し関係をツリー形式で提供します。 

![マルチトランザクションツリービュー](/img/multi-tx-tr.png)

![number 4](/img/number-04.png)領域は、ツリー構造として表現された詳細の表現方式オプションです。**_単一行で見る_**と**_複数行で見る_**の2つの方法を提供します。**_単一行で見る_**表現方式が基本設定です。上部のボタンを使用して一括的に制御でき、各行を選択して個々の表現方式の切り替えが可能です。

![number 5](/img/number-05.png)領域は、所要時間オプションです。![タイムバーアイコン](/img/ic-dashbaord-bar-chart-h.svg) **_タイムバー_**、![タイムセットアイコン](/img/ic-custom-time.svg) **_タイムセット_**、![非表示処理アイコン](/img/ic-eye-invisible.svg) **_非表示処理_**の3つの方法を提供します。開始と所要時間の場合、トランザクションの呼び出し環境によって発生する時間差は、上位トランザクション内のトレースとマッピングを使用し、補正して表現されるため、実際に収集された時間データと差異が生じる可能性があります。所要時間は、その値に応じて次のように色で表現されます。

-   8秒以上：<span class='etrs'>超過遅延</span>状態で<span class='etrs'>赤</span>で表現します。
-   3秒以上8秒未満：<span class='ov5ud10'>遅延</span>状態で<span class='ov5ud10'>オレンジ</span>で表現します。
-   3秒未満：<span class='woer'>正常</span>状態で<span class='woer'>青</span>で表現します。

![number 6](/img/number-06.png)領域は、各トレースタイプによって統計やクエリ情報などを確認できる専用オプションを提供します。トレースの![統計アイコン](/img/ic-static.svg)アイコンまたは![ポップアップアイコン](/img/ic-popup.svg)アイコンを選択すると、**_HTTP呼び出し統計_**、**_アクティブスタック_**などの要約ウィンドウが確認できます。

## 参考資料

-   [マルチトランザクションメニューの追加](https://www.whatap.io/ko/blog/85/index.html)
-   [マルチトランザクションダイアグラムの改善](https://www.whatap.io/ko/blog/72/index.html)
