### 詳細な分析要素のガイド{#details}

![profile_apm sc](/img/tx-trace-static.png)

#### ![number1](/img/number-01.png) トランザクション属性と性能情報

右上の**_もっと見る_**ボタンをクリックすると、次のようにトランザクション属性と性能の要約情報が確認できます。 

![profile_apm](/img/tx-trace-dt.png)

-   ![統計アイコン](/img/ic-static.svg) **_統計_**：URLの統計データ **_要約_** ウィンドウが表示されます。 **_概要_** ウィンドウから **_詳細 >_** ボタンをタップすると **_統計/分析_** > **_統計_** 画面に移動します。 
-   ![右矢印アイコン](/img/ic-arrow-right.svg) **_MTID_**：関連トランザクションの追加で表示および分析できます。

**トランザクションの属性と性能**

| プロパティ                                    | 性能情報                                                      |
| ---------------------------------------- | --------------------------------------------------------- |
| **プロジェクトコード**                            | WhaTapモニタリングプロジェクトコード                                     |
| **OID**                                  | アプリケーション(エージェント) オブジェクトID                                 |
| **Oname**                                | アプリケーションオブジェクト名                                           |
| **Type**                                 | アプリケーションタイプ - Java、Node.Js、PHP、Pythonなど                   |
| **TID**                                  | トランザクションID                                                |
| **UrlHash**                              | URLのhash値                                                 |
| **UserToken**                            | ユーザートークン - WhaTapが付与した任意のユーザーID                           |
| **Method**                               | HTTPメソッド - GET、POST、PUT、HEAD など                           |
| **StartTime**                            | トランザクションの開始時間                                             |
| **EndTime**                              | トランザクションの終了時間                                             |
| **Elapsed**                              | トランザクション実行時間                                              |
| **CpuTime**                              | CPUの占有時間                                                  |
| **MemAlloc**                             | トランザクションによって使用したメモリ量                                      |
| **Ipaddr**                               | クライアントIP                                                  |
| **Country**                              | クライアントの国情報                                                |
| **City**                                 | クライアントの都市情報                                               |
| **SqlCount**                             | SQLの実行件数                                                  |
| **SqlTime**                              | SQL実行時間                                                   |
| **FetchCount**                           | SQLでデータを検索したレコード件数                                        |
| **FetchTime**                            | レコードの検索にかかった時間(重複が発生したり、他のロジックが含まれる場合もある)                 |
| **HttpcCount**                           | 外部のHttp Call件数                                            |
| **HttpcTime**                            | 外部のHttp Call時間                                            |
| **ClientOs**                             | クライアントのOS                                                 |
| **ClientOsPro**                          | クライアントのOS会社                                               |
| **ClientType**                           | クライアントのタイプ (例：ブラウザー)                                      |
| **ClientName**                           | クライアントのブラウザー名                                             |
| **UserAgent**                            | ウェブクライアント情報。これに基づいて構文解析を行い、ClientOs、ClientOsProなどの情報を抽出する |
| **MTID** <span class='normal'>\*</span>  | マルチトランザクションID                                             |
| **Depth** <span class='normal'>\*</span> | マルチトランザクションがどの層であるかを示します                                  |
| **Caller TID**                           | 呼び出し元のトランザクションのTid                                        |

:::note

-   エージェントのアプリケーションタイプや設定によっては、表示されない項目がある場合があります。

-   **_統計_**メニューの詳細については、[次の文書](analysis-apm-trs)を参照してください。

<InDoc product='dotnet'>

-   <span class='normal'>*</span>: .Netモニタリングはマルチトランザクションをサポートしていません。

</InDoc>

<Xclude product='dotnet'>

-   マルチトランザクション追跡の詳細については、[次の文書](trs-multi-trace) を参照してください。

</Xclude>

:::

#### ![number2](/img/number-02.png) トランザクショントレースの詳細情報

<Xclude product='dotnet'>

![number2](/img/number-02.png) 領域でトランザクション実行の詳細履歴を確認できます。 **_ダイアグラム_** チャートは、この詳細情報を要約してグラフとして表現したものです。 **_マルチTXチャート_**では、トランザクションごとの連携情報を確認できます。 一覧から **_テーブルビュー_** タブを選択すると、段階別 **_区間時間_**そして **_所要時間_** および **_ステップ内容_** などを確認し、遅くなった区間を確認することができます。 **_テーブルビュー_** タブの各カラムのトランザクショントレース情報は次のとおりです。

</Xclude>

<InDoc product='dotnet'>

![number2](/img/number-02.png) 領域でトランザクション実行の詳細履歴を確認できます。 **_ダイアグラム_** チャートは、この詳細情報を要約してグラフとして表現したものです。一覧から **_テーブルビュー_**タブを選択すると、段階別 **_区間時間_**と**_所要時間_** および **_ステップ内容_** などを確認し、遅くなった区間を確認することができます。 **_テーブルビュー_** タブの各カラムのトランザクショントレース情報は次のとおりです。

</InDoc>

-   **_段階_**：ステップの発生順序

-   **_間隔時間_**：各段階の開始・終了時間

-   **_ギャップ_**：直前ステップと現在ステップの間のギャップ時間

-   **_所要_**：各メソッドの開始から終了までの所要時間

-   **_ステップ内容_**：ステップの詳細な実行履歴

その中の **_ステップ内容_**は、次のように分けられます。

-   **HTTP-HEADERS**：収集されたHTTP Header情報を表示します。

-   **HTTP-PARAMETERS**：収集されたHTTP Parameter情報を表示します。

-   **DB接続**：DB接続のURLと接続時間を表示します。

-   **SQL**：JDBC SQLに対するSQL文、レスポンス時間エラーを表示します。

-   **HTTP Call**：外部httpサービスのURLとレスポンス時間、エラーを表示します。

-   **Message**：メッセージステップの非定型的なすべての区間の履歴を表示します。 ファイルオープン、Http Header出力、パラメータ出力、あるいはユーザーも任意の場所を指定するために使用できます。

-   **SOCKET**：Socketオープンを表します。 レスポンス時間は追跡しません。

-   **METHOD**：エージェントに追跡が設定されたメソッド名とレスポンス時間を表示します。

-   **アクティブスタック**：アクティブスタックが収集されたことを意味します。 **_アクティブスタック_** ボタンを選択すると **_アクティブスタック_** ウィンドウが表示され、詳細を確認できます。

**_ツリービュー_**を選択すると、次のようにツリービューの形で分析を確認できます。 アクティブスタックと先に実行されたメソッドとの相関関係を確認するには、そのステップの番号を確認し **_ツリービュー_** タブで次の番号を確認することができます。 多くのメソッドトレースを設定した場合は **_テーブルビュー_**での状態分析がうまくできない場合があります。 一方、メソッドトレース設定をほとんどしていない状態では **_テーブルビュー_**を分析するのに有利です。 

![ツリービュー](/img/tx-trace-tree.png)

-   **_メソッド要約_**タブは、トレースステップ情報で重複実行されたメソッドに関する分析情報を提供します。 

-   **_SQL要約_**タブは、トレースステップ情報で重複実行されたSQL文に関する分析情報を提供します。 

-   **_HTTP呼び出し要約_**タブは、HTTP呼び出しの呼び出し件数、合計時間、平均時間などを提供します。 

<Xclude product='dotnet'>

-   **_マルチTX テーブル_**タブは、マルチトランザクションの詳細を提供します。

</Xclude>

:::note

**アクティブスタック**

WhaTapは、複数のユーザー リクエストを10秒ごとにスナップショットとして保存します。 スナップショットに保存されたスタック情報はトランザクションに含まれ、スタック情報を **_アクティブスタック_**と呼ばれます。

:::

### トランザクションパラメータの検索

1.  SQLSQL変数とHTTPクエリを検索するために、エージェント設定を追加してください。

    ```bash title='whatap.conf' {1,3}
    profile_sql_param_enabled=true 
    // SQLパラメータ検索オプション：オプションが適用されると、SQLパラメータを暗号化して収集します。
    profile_http_parameter_enabled=true 
    // HTTPパラメータ検索オプション：オプションが適用されると、HTTPクエリパラメータを暗号化して収集します。
    ```

2.  設定を適用した後、トレースステップ内のSQL文を選択すると、パラメータを参照できます。

    ![profile-sql](https://img.whatap.io/media/images/Screenshot_2020-12-15_W_JAVA_DEMO_5490_-_Application_Monitoring18.png)  

3.  パラメータ検索に必要なキーは、エージェントがインストールされているサーバーのパス _$WHATAP_HOME/paramkey.txt_ ファイル内の6桁の文字列です。 他の任意の文字列に変更できます。

    ```bash title='paramkey.txt'
    whatap@vmwas01:/apps/whatap$ cat paramkey.txt
    A1B2C3
    ```

    :::note

    _paramkey.txt_内のキーは、SQL変数の検索、HTTPクエリの検索、Threadの停止に必要です。

    :::
