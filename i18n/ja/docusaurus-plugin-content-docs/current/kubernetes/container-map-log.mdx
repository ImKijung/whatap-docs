---
id: container-map-log
title: Log
description: コンテナまたはコンテナ内部で実行中のアプリケーションが出力するログをすぐに確認できます。
tags:
  - Kubernetes
  - Kubernetesモニタリング
  - Log
---

ホーム画面 > プロジェクト選択 > **_ダッシュボード_** > **_コンテナマップ_** > 対象選択後**詳細を見る**画面に進入 > **_ログ_**

## Kubernetesログ

WhaTap Kubernetesモニタリング サービスは、Kubernetesで発生するログを収集して保存します。 

<!-- 

실시간으로 발생하는 로그는 컨테이너 ***Stdout/Stderr*** 탭의 최근 로그 메시지와 ***로그 검색*** 탭을 통해 조회할 수 있습니다. >

-->

Kubernetesには、次の2種類のログがあります。

-   各コンテナのStandard Out（標準出力）ログ
-   各コンテナの内部で実行中のアプリケーションが出力するログ

このようなログは、コンテナの状態やメトリクス情報では確認しにくいモニタリングの死角地帯を補完する役割を果たします。このログを確認する方法は次のとおりです。

-   各コンテナのStandard Outログの場合は、コンテナ内部に進入しなくてもKubernetesが提供する`kubectl logs`コマンドで確認できます。
-   各コンテナ内部のアプリケーションログは、コンテナ内部に進入して確認するか、別途のログ収集方法を策定する必要があります。

## 最近のログメッセージ （コンテナStdout／Stderr）

現在のコンテナログをすぐに確認できる機能です。ユーザーのクラスター環境から直接ログを取得し、選択したコンテナのリアルタイムログまたは選択したPod内アプリケーションのリアルタイムログを確認できます。通常、コンテナログを確認するには、次のコマンドを使用します。

```bash
kubectl logs pod/<Pod名> -n <Namespace名>
```

Pod内に2つ以上のコンテナが存在する場合は、個々のコンテナを選択してログを確認します。

```bash
kubectl logs pod/<Pod名> -c <コンテナ名> -n <Namespace名>
```

ログを確認するために毎回ターミナル画面にアクセスしてコマンドラインツールを実行するのは非常に不便です。WhaTap Kubernetesモニタリングの**_ログ_**機能を使用すると、現在のログを便利に確認できます。 

![最近ログメッセージ](/img/k8s-container-log.png)

ただ、注意点があります。まず、コンテナを終了すると、ログを確認できなくなります。また、コンテナが継続して実行中であっても、一定期間または一定容量のログだけを確認できるというデメリットがあります。WhaTapの最近のログメッセージ(**_コンテナStdout/Stderr_**) 機能は、ユーザーKubernetes環境のログをWhaTapを通じて確認できるように提供する機能であり、ユーザー環境から消えたログは、WhaTapでも確認できません。 

したがって、ログデータを安定的かつ継続的に管理するためには、別途の管理策が不可欠です。特にマイクロサービスアーキテクチャの導入が広がり、ビジネスを構成するコンテナ数量が増加するにつれてログの確認、管理策はさらに複雑になりつつあります。

いい方法があるでしょうか？

## ログ検索

コンテナ終了時に関連ログはすべて消えますが、**_ログ検索_**機能を通じて選択したコンテナまたはPodで過去に発生したログを確認できます。コンテナStandardOutログを保存する時、ご希望の保存期間を設定でき、特定の対象別情報を確認したり、相互連携分析ができます。 

![ログ検索](/img/k8s-log-search.png)

-   ![number 1](/img/number-01.png)時間セレクターを通じてデータ照会したい時点を選択できます。 

-   ![number 2](/img/number-02.png)カテゴリを指定して照会することができます。照会できるカテゴリの説明については、次のブロックとグループ案内を参考にしてください。

-   ![number 3](/img/number-03.png) ![もっと見るアイコン](/img/ic-caret-right.svg) **_もっと見る_**アイコンを選択すると、当該ログの構文解析されたキーと値、およびログメッセージを確認できます。詳しい内容は、[次の文書](../log/log-search)を参考にしてください。

#### 一般ブロックとマイクロブロック

![コンテナブロックsc](/img/k8s-block.png)

-   ![aアイコン](/img/char-a.svg) **一般ブロック**

    コンテナマップの1つの多角形をブロックといいます。ログの`containerStdout`カテゴリーで`containerid`が一致する情報を確認できます。

-   ![bアイコン](/img/char-b.svg) **マイクロブロック**

    エージェントがインストールされているブロックをマイクロブロックと言います。`containerStdout`カテゴリーだけでなく`AppLog`、`AppStdOut`、`AppStdErr`など`App*`関連カテゴリも確認できます。該当カテゴリを選択する場合、`microOid`(ブロック内のエージェントid)が一致するログ情報を確認できます。

#### グループ

![コンテナブロックグループsc](/img/k8s-container-group.png)

**_コンテナマップ_**画面で全体ブロックを選択した場合、または**詳細を見る**画面のカードでブロックを多重選択した場合、その多重ブロックをグループといいます。グループ選択時、**_ログ検索_**タブで`containerStdout`カテゴリと`App*`カテゴリのすべてのログを確認できます。

:::caution

WhaTapログサービスを活性化してコンテナのStandard Outputログ保存機能を使用すると、それに伴う追加費用が請求されます。関連する料金の詳細については、[次の文書](https://www.whatap.io/ko/pricing/)を参考にしてください。

:::

:::note

一部の旧バージョンエージェントの場合は、コンテナStandard Outputを通じたログ保存機能を提供しません。エージェントのアップグレード方法は次のとおりです。

```bahs title='Agent update'
kubectl set image daemonset/whatap-node-agent whatap-node-agent=whatap/kube_mon:<エージェントバージョン> -n whatap-monitoring
```

WhaTap Kubernetesエージェントバージョンについては、 [次の文書](https://hub.docker.com/r/whatap/kube_mon/tags)で確認できます。

:::

### Standard Out保存のためのNodeエージェント設定の追加

WhaTapログサービスを通じてコンテナのStandard Outputを保存するためには、WhaTap Kubernetes Nodeエージェントに`logsink_enabled=true`設定を追加する必要があります。WhaTap Kubernetes NodeエージェントはDaemonSet形式です。

-   WhaTapモニタリングサービスページで**_管理_** > **_エージェント設定_**を通じて、`logsink_enabled=true`設定を追加
-   クラスタープロジェクトの全体ノードを対象に設定を追加するには、**_プロジェクトデフォルト_** > **_Node_**を対象に設定を追加
-   一部のNodeを対象に設定を追加するには、単一または複数のNodeを選択した後に設定を追加

**_管理_** > **_エージェント設定_** > Nodeエージェント選択 > **_+ オプション追加_** > すべてのエージェントに適用するオプションを選択 > 適用対象Node選択 

![エージェント設定](https://img.whatap.io/media/images/whatap_kubernetes_container_map_logsink_enabled.png)

## ログ検索移動

![ログ検索移動sc](/img/k8s-log-search-to-log-search.png)

**_ログ_**タブの右側の**_ログ検索_**ボタンをクリックするとフィルター機能などで詳細照会ができる**_ログ_** > **_ログ検索_**メニューに移動します。 

:::note

WhaTapログモニタリングサービスの詳細については、[次の文書](../log/introduction)を参考にしてください。 

:::

<!-- 

로그 검색 이동 제거 예정

-->
