---
id: log-process
title: ログタイムスタンプの基準
description: ログタイムスタンプの基準時間について案内します。
tags:
  - ログモニタリング
  - ログ処理
  - ログタイムスタンプ
---

本文書は、ログモニタリングのフローの**処理**(Processing) 過程でのログ**_タイムスタンプ_**基準時間について説明します。

## タイムスタンプ基準時間の変更

<ImgLang img="log-timestamp.png" desc="ログタイムスタンプ基準時間の変更" />

ログ**_タイムスタンプ_**基準時間が**WhaTapエージェントがログを収集した時間**から**WhaTap収集サーバーのログ処理時間**に変更されました。

一般的な状況では、変更前と大差なく、従来の方式と同様にログを検索できます。 変更後、次の場合でもユーザーによる追加の修正なしにログモニタリングを一貫して使用できます。

-   NTP(Network Time Protocol)を使用場合、モニタリング対象のサーバー時間が標準時間より過去、もしくは未来時間に設定されている時

-   NTP未使用の場合、2つ以上のモニタリング対象のサーバー時間が異なる時

## 変更事項の詳細を確認する

### タイムセレクタ照会範囲の指定

タイムスタンプの基準時間変更により、タイムセレクタも**WhaTap収集サーバー時間**を基準に動作します。 これによって**エージェント収集時間**と**WhaTap収集サーバー時間**に差が生じ、照会範囲に含まれないログが発生することがあります。 この場合、照会範囲を広く指定して照会することができます。

### ログトレンド

**_ログトレンド_**推移チャートのX軸の基準は最小1分です。 ログ基準時間が変更された後も、チャートを通じた全体的な推移把握には影響しません。

### ログ検索

ログメッセージにログ生成時間を示すインデックスである`agenttime`が追加されました。 `agenttime`値を使用してエージェントの収集時間を確認してください。

:::note 

UTC(Coordinated Universal Time)基準の**WhaTap収集サーバー時間**は、ユーザーブラウザ時間に応じて変換して表記します。

> 例）日本の場合、UTC+9を基準に時間を表記します。 

:::

## 段階別基準時間

ログは、次の3つの過程を経て収集されます。 過程ごとに異なる基準時間が使用されることがあります。 

1.  **ログ発生時間**

    モニタリング対象の時間、もしくはLoggingポリシーによって違いが生じることがあります。 

1.  **エージェント収集時間** 

    使用中のサービス、またはエージェントがログを収集する方法とログによって違いが発生することがあります。 

    * **Application**

      設定に応じて、ログライブラリまたはログファイルからリアルタイムに近いログを収集します。

      :::note 

      ログライブラリは、Java製品の場合にのみサポートされます。

      :::

    * **Server** 

      ログファイルからリアルタイムに近いログを収集します。

    * **AWS Log**

      AWS Resource ポリシーに従って、準リアルタイムまたは数分ごとにログを収集します。

1.  **WhaTap収集サーバー時間**

    モニタリング対象、またはログの作成方法に関係なく、収集サーバーに保存される時間を使用します。 

**WhaTapエージェント収集時間**と**WhaTap収集サーバー時間**には、多少の違いがあることがあります。 モニタリング対象のサーバー時間を確認してください。 モニタリング対象のサーバー時間が過去、もしくは未来の時間に設定されている場合、エージェントの収集時間に影響します。
