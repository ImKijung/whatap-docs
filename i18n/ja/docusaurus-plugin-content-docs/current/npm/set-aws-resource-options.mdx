---
id: set-aws-resource-options
title: AWSリソース情報の収集オプション
description: AWS環境でリソース情報を収集し、トポロジー画面に表現できます。
tags:
  - ネットワーク性能モニタリング
  - エージェント
  - AWS
  - Amazon Linux
---

AWS環境でネットワーク性能モニタリングを使用するには、各リソース(LBなど)に接続されたEC2ネットワークインタフェース(ENI)情報を収集することでトポロジーに表現できます。 AWS要素にエージェントを直接インストールすることができないため、収集されたIPを基準に関連付けられたENIを確認して表現します。

![Example](/img/npm-aws-resource-example.png)

AWSのELBを通じて内部にトラフィックが認可される場合、図のようにENIに表現された情報を通じてトポロジーに表現することができます。 AWS ENIの`Description`フィールドを基準に表現します。 もし`Description`フィールドに何の情報も残さない場合、`NetworkInterfaceId`属性を提供します。

## エージェントオプション及び権限設定

_/usr/whatap/whatap-npmd/whatap.conf_ファイルに対して次のようにオプションを設定してください。 大括弧([ ]) の部分にはAWSで発行された認証情報を入力してください。 その際に必要なユーザ権限は、`ec2:DescribeNetworkInterfaces`となります。

```ini title='whatap.conf'
awsInfoEnable=1
# AWS access key
awsAccessKey=[User Access Key]
# AWS secret access key
awsSecretKey=[User Secret Key]
# Region
awsRegions=[RegionCode1,RegionCode2,...]
```

次のコマンドを使用して、オプションを追加できます。

```bash
echo "awsInfoEnable=1" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsAccessKey=[User Access Key]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsSecretKey=[User Secret Key]"  |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsRegions=[RegionCode1,RegionCode2,...]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null

sudo service whatap-npmd restart
```

-   **awsInfoEnable**

    AWS情報照会の使用有無を設定します。 デフォルト値は`0`であり、AWS情報を照会するには`1`に設定してください。

-   **awsAccessKey**

    ユーザーのAWS access key(アクセスキー)を入力してください。

-   **awsSecretKey**

    ユーザーのAWS secret access Key(秘密アクセスキー)を入力してください。

-   **awsRegions**

    ユーザーのリソースを含むリージョンを入力してください。 遠くのリージョンを使用する場合は、コンマ(,)を区切り文字として入力してください。

:::note

-   AWSのAccess Key生成についての詳細は、[次のリンク](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html?icmpid=docs_iam_console#Using_CreateAccessKey)を参考にしてください。

-   `ec2:DescribeNetworkInterfaces`: EC2ネットワークインターフェース(ENI)に関する情報の照会を許可します。

:::

:::tip

Kubernetes環境の場合、次の画像を参考にしてYAMLファイルに黄色いボックス領域の内容を追加してください。

![K8s example](/img/npm-aws-resource-k8s-example.png)

大括弧([ ]) の部分にはAWSで発行された認証情報を入力してください。

```yaml
echo "awsInfoEnable=1" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsAccessKey=[User Access Key]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsSecretKey=[User Secret Key]"  |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsRegions=[RegionCode1,RegionCode2,...]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
```

:::
