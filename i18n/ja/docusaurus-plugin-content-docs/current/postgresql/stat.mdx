---
id: stat
title: 統計データの確認
description: データベースごとの統計データを提供します。
tags:
  - PostgreSQL
  - データベース
  - データベースモニタリング
  - 統計
---

import Note from '../common-items/_import_v2-note.mdx';

<Note product='PostgreSQL' link='../postgresql-v1/stat' />

<!-- 概要-->

{@include: ../common-items/_db-stat-desc.mdx}

<!-- SQL統計-->

{@include: ../common-items/_db-stat-sql-desc.mdx}

<!-- SQL統計の基本使用の案内 -->

{@include: ../common-items/_db-stat-sql-basic.mdx}

<!-- クエリ別の実行推移、詳細を見る-->

{@include: ../common-items/_db-stat-sql-view-query.mdx}  

### カラム情報ガイド

{@include: ../common-items/_db-sql-stat-column.mdx}

## PG SQL統計

ホーム画面 > プロジェクト選択 > **_統計／レポート_** > **_PG SQL統計_**

PostgreSQLが提供するSQL統計(実行回数、実行時間、Row数など) は、`pg_state_statements`ビューを使用して収集します。

:::note

`pg_stat_statements`モジュールの詳細については、[次のリンク](https://www.postgresql.org/docs/current/pgstatstatements.html)を参照してください。

:::

### 設定

**_PG SQL統計_**メニューを使用するには、モニタリング対象DBで次の設定が必要です。

1.  PostgreSQL拡張パックをインストールしてください。

    ```bash
    yum install postgresql-contrib
    ```

2.  _postgresql.conf_ファイルにパラメータを設定し、DBを再起動してください。

    ```ini title='postgresql.conf'
    shared_preload_libraries = 'pg_stat_statements'
    ```

3.  使用するDBに接続し、拡張モジュールをインストールしてください。

    ```bash
    create extension pg_stat_statements;
    ```

4.  データを表示するか確認してください。

    ```bash
    select * from public.pg_stat_statements
    ```

### 基本画面ガイド

<ImgLang img='db-pg-sql-stat.png' desc='PG SQL統計' />

1.  時間でデータを表示する時間と日付を選択してください。緑色のボタンを選択して検索時間を選択することができます。

2.  インスタンスのデータを表示する対象を選択してください。複数のインスタンスを選択でき、すべてのインスタンスを選択するには、**_全体選択_**をクリックしてください。

3.  ![検索アイコン](/img/ico-btn-search.png)ボタンを選択してください。

上位50件のテーブルを表示します。

:::note

-   任意の日付と時間を表示するには、時計の表示を選択してください。日付と時間のテキスト領域をクリックすると、日付と時間を選択するオプションが表示されます。

-   テーブルヘッダーの各カラムをクリックすると、選択したカラムをソートすることができます。

-   **_参照基準_**で選択した項目に従ってソートすることができます。ご希望の項目を選択した後![検索アイコン](/img/ico-btn-search.png)ボタンを選択してください。 

-   **_参照件数_**でテーブルに表示する件数を設定できます。設定を完了した後![検索アイコン](/img/ico-btn-search.png)ボタンを選択してください。 

-   参照した内容をcsv形式のファイルにダウンロードするには、![Download icon](/img/ico-download.svg)ボタンを選択してください。

-   取得された結果一覧から**_query_**項目を選択すると**_SQL詳細_**ウィンドウが表示されます。詳細については、[次の文書](#query-details)を参照してください。

:::

### カラム情報ガイド

| 項目                  | 説明                                                         |
| ------------------- | ---------------------------------------------------------- |
| query               | クエリ文字列                                                     |
| queryid             | クエリハッシュコード                                                 |
| ユーザー                | ユーザーoid                                                    |
| db                  | データベース名                                                    |
| rows                | 検索または影響を受けるROWの総数                                          |
| total_exec_time     | クエリの実行に費やされた合計時間(ミリ秒)                                      |
| calls               | 実行回数                                                       |
| shared_blks_hit     | 共有ブロックキャッシュの合計総数                                           |
| shared_blks_read    | ディスクから読み込んだ共有ブロックの総数                                       |
| blk_read_time       | ブロックの読み取りにかかった合計時間(ミリ秒)、`track_io_timing`が有効な場合、それ以外の場合は0  |
| blk_write_time      | ブロックを書き込みに費やされた合計時間、`track_io_timing`が有効になっている場合、それ以外の場合は0 |
| local_blks_dirtied  | 変更されたローカルブロック数                                             |
| local_blks_hit      | ローカルブロックキャッシュヒット数                                          |
| local_blks_written  | ディスクに書き込まれたローカルブロックの総数                                     |
| local_blks_read     | ディスクで読み込んだローカルブロックの総数                                      |
| shared_blks_written | ディスクに書き込まれた共有ブロックの総数                                       |
| shared_blks_dirtied | 変更された共有ブロックの総数                                             |
| temp_blks_read      | ディスクから読み取られた一時ブロックの総数                                      |
| temp_blks_written   | ディスクに書き込まれた一時ブロックの総数                                       |

## 統計メニューオプションの利用

### クエリの詳細を見る{#query-details}

<ImgLang img='db-pg-sql-stat-sql-details.png' desc='SQL詳細' />

照会された結果一覧で**_query_**項目を選択すると**_SQL詳細_**ウィンドウが表示されます。 

-   **_プランを見る_**：DB Name、User Name、Passwordを入力すると**_Plan_**情報を確認できます。

-   **_パラメータ_**：クエリ文で変数として設定された部分を**_default_**値でバインディングできます。**_clear_**ボタンを選択すると、バインディングされた値を解除します。

-   **_Formatting_**：トグルボタンを選択し、SQL文をインデント、フォーマット化して可読性を高めることができます。

-   **_関連アプリケーション_**：当該クエリに関連付けられたアプリケーションプロジェクトに移動できます。一覧でプロジェクトを選択し![arrow icon](/img/ic-arrow-right.svg)ボタンをクリックしてください。選択したプロジェクトの**_統計/レポート_** > **_統計_**メニューに移動します。

### 照会結果フィルタリング

<ImgLang img='db-sql-stat-add-filter.png' desc='Filtering' />

照会された結果をSQLのパラメータ値に基づいてフィルタリングすることができます。

1.  **_フィルター追加_**ボタンを選択してください。 

2.  **_条件入力_**テキストボックスに希望の値を入力して**_保存_**を選択してください。 

3.  ![検索アイコン](/img/ico-btn-search.png)ボタンを選択してください。

入力したSQLパラメータ値を含む結果が一覧に表示されます。

:::note

フィルターを解除するには、**_フィルター_**の![削除アイコン](/img/ico-remove-white.svg)ボタンを選択してください。

<ImgLang img='db-sql-stat-disable-filter.png' desc='Disable filter' />

:::

### テーブルカラムの設定{#change-column}

{@include: ../common-items/_db-v2-data-edit-column.mdx} 

<!-- データベースサイズ-->

<!-- {@include: ../common-items/_db-databasesize-desc.mdx}-->
